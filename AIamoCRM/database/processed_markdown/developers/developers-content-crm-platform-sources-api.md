---
title: "Источники"
description: "Система amoCRM – удобная web программа для анализа продаж, доступная в режиме online из любой точки мира! Подробности узнавайте по указанным на сайте телефонам в Москве."
url: https://www.amocrm.ru/developers/content/crm/platform/sources-api
section: developers
---

В данном разделе описываются доступные методы для работы с API источников.

Через методы API источников интеграция может управлять только своими источниками.  
Интеграция идентифицируется посредством проверки переданного Access Token.

Одна интеграция может создать не более 100 активных источников.

API источников позволяет интеграции сообщить amoCRM в какой воронке должно быть создано неразобранное.

На данный момент созданные интеграцией источники учитываются:

- если переданы через API чатов, при создании неразобранного
- при настройке действия "Написать сообщение" в боте в .com аккаунтах (Если источник не создан, то его не будет в настройках этого действия)
- при работе функционала "Написать первым" (у пользователя будет возможность выбирать через какой именно источник написать первым клиенту в карточке сделки)
- отображаются в сделке в разделе статистика
- источник может быть указан при создании сделки через [API](https://www.amocrm.ru/developers/content/crm_platform/leads-api) в `_embedded[source][external_id]`

Также через API источников интеграция может добавить варианты выбора номеров WhatsApp,  
которые используются при настройке кнопки на сайт – [СRM Plugin](https://www.amocrm.ru/support/incoming_leads/dp_button)

Источнику можно указать свойство waba если интеграция работает с белым WhatsApp и настроено временное окно. Параметр даёт возможность управления шаблонами WhatsApp и использовании их в новом шаге "Отправить сообщение" в Salesbot. После указания данного параметра следует [подписаться](https://www.amocrm.ru/developers/content/crm_platform/webhooks-api#webhook-subscribe) на события отправки шаблона на утверждение. Получив такое событие интеграция может передать шаблон на одобрение в WhatsApp и в зависимости от результата изменить статус шаблона WhatsApp через [API](https://www.amocrm.ru/developers/content/crm_platform/chat-templates-api#Редактирование-статуса-шаблона-WhatsApp)

### Оглавление

- [Требования к интеграции для работы с API источников](#Требования-к-интеграции-для-работы-с-API-источников)
- [Получение списка источников](#Получение-списка-источников)
- [Получение источника по ID](#Получение-источника-по-ID)
- [Добавление источников](#Добавление-источников)
- [Редактирование источников](#Редактирование-источников)
- [Удаление источников](#Удаление-источников)
- [Создание CRM Plugin](#Создание-CRM-Plugin)
- [Подключение онлайн-чата к CRM Plugin](#Подключение-онлайн-чата-к-CRM-Plugin)
- [Изменение CRM Plugin](#Изменение-CRM-Plugin)
- [Получение одного CRM Plugin](#Получение-одного-CRM-Plugin)
- [Получение списка CRM Plugin](#Получение-списка-CRM-Plugin)

### Требования к интеграции для работы с API источников

Источники, создаваемые интеграцией отображаются в разделе настроек Digital Pipeline.  
Пользователь может взаимодействовать с источником и интеграцией через интерфейс,  
поэтому интеграции для работы с источниками требуется загруженный архив.  
Таким образом с API источников могут взаимодействовать все интеграции за исключением типа ["Внешняя интеграция"](https://www.amocrm.ru/developers/content/crm_platform/platform-abilities).

Перед началом работы с API источников нужно удостоверится что интеграция соответствует следующим критериям:

1. Интеграция обладает загруженным архивом (виджетом) и в файле manifest.json виджета указана возможность  
   отображения виджета в интерфейсе добавления нового источника `"locations":["lead_sources"]`
2. Для интеграций, которые работают с чатами: в канале чата должен быть прописан код виджета и ID интеграции.  
   Подробности по работе с каналами указаны в блоке [регистрация канала](https://www.amocrm.ru/developers/content/chats/chat-start) раздела API чатов.

Также у интеграции появляется новое свойство – "Поддерживается ли работа с множественными источниками".  
Данный флаг стоит включить, когда интеграция полностью управляет источниками через API со своего бэкенда и создание источника со стороны amoCRM больше не требуется.  
Если флаг не стоит – при установке интеграции будет создан источник на стороне amoCRM.

### Получение списка источников

#### Метод

*GET /api/v4/sources*

#### Описание

Метод позволяет получить список источников интеграции.

#### Ограничения

Метод доступен с правами администратора. Возвращает не более 100 источников

#### GET параметры

| Параметр | Тип данных | Описание |
| --- | --- | --- |
| filter | object | Доступные поля фильтра смотрите ниже |
| filter[external\_id] | string|array | Фильтр по внешнему идентификатору источника |

#### Заголовок типа данных при успешном результате

*Content-Type: application/hal+json*

#### Заголовок типа данных при ошибке

*Content-Type: application/problem+json*

#### HTTP коды ответа

| Код ответа | Условие |
| --- | --- |
| 200 | Список источников интеграций |
| 204 | У интеграции нет подконтрольных источников или поиск по фильтру не дал результатов |
| 403 | Интеграция не авторизована |

#### Параметры ответа

Метод возвращает коллекцию моделей источников

| Параметр | Тип данных | Описание |
| --- | --- | --- |
| id | int | ID источника |
| name | string | Название источника |
| pipeline\_id | int | ID воронки, воронка может быть архивной |
| external\_id | string | Внешний идентификатор источника на стороне интеграции |
| default | bool | Является ли данный источник источником по-умолчанию. Поле не является обязательным |
| origin\_code | string null | Код основного канала источника. Данный канал чата будет использоваться при инициализации общения. Поле не является обязательным. |
| services | array | Массив сервисов которые связаны с источником. На данный момент поддерживается только WhatsApp. Данные из этого массива используются для отображения в [CRM Plugin](/support/incoming_leads/dp_button) (кнопки на сайт). Поле не является обязательным. |
| services[0][type] | string | тип сервиса, на данный момент поддерживается только один тип: `whatsapp` |
| services[0][params] | object | Объект с настройками источника. Поле не является обязательным. |
| services[0][params][waba] | bool | Является ли источник белым WhatsApp. Следует добавить для возможности работы с одобренными шаблонами WhatsApp в Salesbot в новом шаге отправки сообщения. Поле не является обязательным. |
| services[0][pages] | string | Для WhatsApp сервиса содержит список элементов, которые можно выбрать при настройке CRM Plugin (кнопки на сайт) |
| services[0][pages][0][name] | string | Отображаемое пользователю название пункта в выпадающем списке при настройке кнопки на сайте |
| services[0][pages][0][id] | string | Идентификатор пункта в выпадающем списке (не отображается клиенту и пользователю) |
| services[0][pages][0][link] | string | Номер телефона, который будет указан в кнопке WhatsApp и которому будет писать клиент на странице сайта. В CRM Plugin ссылка будет сформирована следующим образов:  номер телефона} |

#### Пример ответа

```json
{
"\_total\_items": 2,
"\_links": {
"self": {
"href": "https://example.amocrm.ru/api/v4/sources"
}
},
"\_embedded": {
"sources": [
{
"id": 9619,
"name": "Номер отдела продаж",
"pipeline\_id": 1300,
"external\_id": "+17 912 100 00 00",
"default": true,
"origin\_code": null,
"services": [],
"\_links": {
"self": {
"href": "https://example.amocrm.ru/api/v4/sources/9619"
}
}
},
{
"id": 4460,
"name": "Лендинг",
"pipeline\_id": 1301,
"external\_id": "65bd500b-fd52-4599-ab58-943ce3dd058c",
"default": false,
"origin\_code": "amo.ext.30490163\_v2",
"services": [],
"\_links": {
"self": {
"href": "https://example.amocrm.ru/api/v4/sources/4460"
}
}
}
]
}
}
```

### Получение источника по ID

#### Метод

*GET /api/v4/sources/{id}*

#### Описание

Метод позволяет получить список источников интеграции.

#### Ограничения

Метод доступен с правами администратора.

#### Заголовок типа данных при успешном результате

*Content-Type: application/hal+json*

#### Заголовок типа данных при ошибке

*Content-Type: application/problem+json*

#### HTTP коды ответа

| Код ответа | Условие |
| --- | --- |
| 200 | Источник найден |
| 204 | У интеграции нет подконтрольных источников или источник удален |
| 403 | Интеграция не авторизована |

#### Параметры ответа

Метод возвращает коллекцию моделей источников

| Параметр | Тип данных | Описание |
| --- | --- | --- |
| id | int | ID источника |
| name | string | Название источника |
| pipeline\_id | int | ID воронки, воронка может быть архивной |
| external\_id | string | Внешний идентификатор источника на стороне интеграции |
| default | bool | Является ли данный источник источником по-умолчанию. Поле не является обязательным |
| origin\_code | string null | Код основного канала источника. Данный канал чата будет использоваться при инициализации общения. Поле не является обязательным. |
| services | array | Массив сервисов которые связаны с источником. На данный момент поддерживается только WhatsApp. Данные из этого массива используются для отображения в [CRM Plugin](/support/incoming_leads/dp_button) (кнопки на сайт). Поле не является обязательным. |
| services[0][type] | string | тип сервиса, на данный момент поддерживается только один тип: `whatsapp` |
| services[0][params] | object | Объект с настройками источника. Поле не является обязательным. |
| services[0][params][waba] | bool | Является ли источник белым WhatsApp. Следует добавить для возможности работы с одобренными шаблонами WhatsApp в Salesbot в новом шаге отправки сообщения. Поле не является обязательным. |
| services[0][params][is\_supports\_list\_message] | bool | Поддерживает ли источник шаг "List Message" в Salesbot . Следует добавить для отображения нового шага List Message в Salesbot. Поле не является обязательным. |
| services[0][pages] | string | Для WhatsApp сервиса содержит список элементов, которые можно выбрать при настройке CRM Plugin (кнопки на сайт) |
| services[0][pages][0][name] | string | Отображаемое пользователю название пункта в выпадающем списке при настройке кнопки на сайте |
| services[0][pages][0][id] | string | Идентификатор пункта в выпадающем списке (не отображается клиенту и пользователю) |
| services[0][pages][0][link] | string | Номер телефона, который будет указан в кнопке WhatsApp и которому будет писать клиент на странице сайта. В CRM Plugin ссылка будет сформирована следующим образов:  номер телефона} |

#### Пример ответа

```json
{
"id": 9619,
"name": "Номер отдела продаж",
"pipeline\_id": 1300,
"external\_id": "+17 912 100 00 00",
"default": true,
"origin\_code": null,
"services": [],
"\_links": {
"self": {
"href": "https://example.amocrm.ru/api/v4/sources/9619"
}
}
}
```

### Добавление источников

#### Метод

*POST /api/v4/sources*

#### Описание

Метод позволяет добавлять источники пакетно.

#### Ограничения

Метод доступен с правами администратора. Добавить одновременно можно не более 50 источников.

#### Заголовок запроса

*Content-Type: application/json*

#### Параметры запроса

Внешний идентификатор источника должен быть уникальным для интеграции в рамках одного аккаунта.

| Параметр | Тип данных | Описание |
| --- | --- | --- |
| name | string | Название источника. Поле является обязательным |
| external\_id | string | Внешний идентификатор источника, не может быть изменен после создания. Длина поля 36 символов, можно использовать любые печатные ascii символы и пробел |
| pipeline\_id | int | ID воронки, к которой относится источник. Поле не является обязательным |
| default | bool | Является ли данный источник источником по-умолчанию. Поле не является обязательным |
| origin\_code | string | Код основного канала источника. Данный канал чата будет использоваться при инициализации общения. Поле не является обязательным. |
| services | array | Массив сервисов которые связаны с источником. На данный момент поддерживается только WhatsApp. Данные из этого массива используются для отображения в [CRM Plugin](/support/incoming_leads/dp_button) (кнопки на сайт). Поле не является обязательным. |
| services[0][type] | string | тип сервиса, на данный момент поддерживается только один тип: `whatsapp` |
| services[0][params] | object | Объект с настройками источника. Поле не является обязательным. |
| services[0][params][waba] | bool | Является ли источник белым WhatsApp. Следует добавить для возможности работы с одобренными шаблонами WhatsApp в Salesbot в новом шаге отправки сообщения. Поле не является обязательным. |
| services[0][params][is\_supports\_list\_message] | bool | Поддерживает ли источник шаг "List Message" в Salesbot. Следует добавить для отображения нового шага List Message в Salesbot. Поле не является обязательным. |
| services[0][pages] | string | Для WhatsApp сервиса содержит список элементов, которые можно выбрать при настройке CRM Plugin (кнопки на сайт) |
| services[0][pages][0][name] | string | Отображаемое пользователю название пункта в выпадающем списке при настройке кнопки на сайте |
| services[0][pages][0][id] | string | Идентификатор пункта в выпадающем списке (не отображается клиенту и пользователю) |
| services[0][pages][0][link] | string | Номер телефона, который будет указан в кнопке WhatsApp и которому будет писать клиент на странице сайта. В CRM Plugin ссылка будет сформирована следующим образов:  номер телефона} |

#### Пример запроса

```json
[
{
"name": "Номер отдела продаж",
"pipeline\_id": 1300,
"external\_id": "+17 912 100 00 00",
"default": true,
"services": [
{
"type": "whatsapp",
"params": {
"waba": true,
"is\_supports\_list\_message": true
},
"pages": [
{
"id": "9121234565",
"name": "WhatsApp +9121234567",
"link": "+9121234567"
}
]
}
]
},
{
"name": "Лендинг",
"external\_id": "65bd500b-fd52-4599-ab58-943ce3dd058c",
"origin\_code": "amo.ext.30490163\_v2"
}
]
```

#### Заголовок типа данных при успешном результате

*Content-Type: application/hal+json*

#### Заголовок типа данных при ошибке

*Content-Type: application/problem+json*

#### HTTP коды ответа

| Код ответа | Условие |
| --- | --- |
| 200 | Источники были успешно созданы |
| 401 | Интеграция не авторизована |
| 400 | Переданы некорректные данные. Подробности доступны в теле ответа |

#### Параметры ответа

Метод возвращает коллекцию источников, которые были добавлены.

| Параметр | Тип данных | Описание |
| --- | --- | --- |
| id | int | ID источника |
| name | string | Название источника |
| pipeline\_id | int | ID воронки, воронка может быть архивной |
| external\_id | string | Внешний идентификатор источника на стороне интеграции |
| default | bool | Является ли данный источник источником по-умолчанию. Поле не является обязательным |
| origin\_code | string | Код основного канала источника. Данный канал чата будет использоваться при инициализации общения. Поле не является обязательным. |
| services | array | Массив сервисов которые связаны с источником. На данный момент поддерживается только WhatsApp. Данные из этого массива используются для отображения в [CRM Plugin](/support/incoming_leads/dp_button) (кнопки на сайт). Поле не является обязательным. |
| services[0][type] | string | тип сервиса, на данный момент поддерживается только один тип: `whatsapp` |
| services[0][params] | object | Объект с настройками источника. Поле не является обязательным. |
| services[0][params][waba] | bool | Является ли источник белым WhatsApp. Следует добавить для возможности работы с одобренными шаблонами WhatsApp в Salesbot в новом шаге отправки сообщения. Поле не является обязательным. |
| services[0][params][is\_supports\_list\_message] | bool | Поддерживает ли источник шаг "List Message" в Salesbot. Следует добавить для отображения нового шага List Message в Salesbot. Поле не является обязательным. |
| services[0][pages] | string | Для WhatsApp сервиса содержит список элементов, которые можно выбрать при настройке CRM Plugin (кнопки на сайт) |
| services[0][pages][0][name] | string | Отображаемое пользователю название пункта в выпадающем списке при настройке кнопки на сайте |
| services[0][pages][0][id] | string | Идентификатор пункта в выпадающем списке (не отображается клиенту и пользователю) |
| services[0][pages][0][link] | string | Номер телефона, который будет указан в кнопке WhatsApp и которому будет писать клиент на странице сайта. В CRM Plugin ссылка будет сформирована следующим образов:  номер телефона} |
| request\_id | string | Строка переданная при запросе или порядковый указатель, если параметр не передан |

#### Пример ответа

```json
{
"\_total\_items": 2,
"\_links": {
"self": {
"href": "https://example.amocrm.ru/api/v4/sources"
}
},
"\_embedded": {
"sources": [
{
"id": 9619,
"name": "Номер отдела продаж",
"pipeline\_id": 1300,
"external\_id": "+17 912 100 00 00",
"default": true,
"origin\_code": null,
"services": [
{
"type": "whatsapp",
"params": {
"waba": true,
"is\_supports\_list\_message": true
},
"pages": [
{
"id": "9121234565",
"name": "WhatsApp +9121234567",
"link": "+9121234567"
}
]
}
],
"\_links": {
"self": {
"href": "https://example.amocrm.ru/api/v4/sources/9619"
}
}
},
{
"id": 4460,
"name": "Лендинг",
"pipeline\_id": 1307,
"external\_id": "65bd500b-fd52-4599-ab58-943ce3dd058c",
"default": false,
"origin\_code": "amo.ext.30490163\_v2",
"services": [],
"\_links": {
"self": {
"href": "https://example.amocrm.ru/api/v4/sources/4460"
}
}
}
]
}
}
```

### Редактирование источников

#### Метод

*PATCH /api/v4/sources*

#### Описание

Метод позволяет редактировать источники пакетно.  
Также вы можете добавить ID источника в метод для редактирования конкретного источника (/api/v4/sources/{id}).  
При пакетном редактировании передается массив из объектов-источников, при редактировании одного источника, передается просто модель источника.

#### Ограничения

Метод доступен с правами администратора. Обновить одновременно можно не более 50 источников

#### Заголовок запроса

*Content-Type: application/json*

#### Параметры запроса

Внешний идентификатор источника (external\_id) изменить нельзя, можно только создать новый источник с таким идентификатором

| Параметр | Тип данных | Описание |
| --- | --- | --- |
| id | int | ID источника, обязателен при пакетном обновлении |
| name | string | Название источника. Поле не является обязательным |
| pipeline\_id | int | ID воронки, к которой относится источник. Поле не является обязательным |
| default | bool | Является ли данный источник источником по-умолчанию. Поле не является обязательным |
| origin\_code | string | Код основного канала источника. Данный канал чата будет использоваться при инициализации общения. Поле не является обязательным. |
| services | array | Массив сервисов которые связаны с источником. На данный момент поддерживается только WhatsApp. Данные из этого массива используются для отображения в [CRM Plugin](/support/incoming_leads/dp_button) (кнопки на сайт). Поле не является обязательным. |
| services[0][type] | string | тип сервиса, на данный момент поддерживается только один тип: `whatsapp` |
| services[0][params] | object | Объект с настройками источника. Поле не является обязательным. |
| services[0][params][waba] | bool | Является ли источник белым WhatsApp. Следует добавить для возможности работы с одобренными шаблонами WhatsApp в Salesbot в новом шаге отправки сообщения. Поле не является обязательным. |
| services[0][params][is\_supports\_list\_message] | bool | Поддерживает ли источник шаг "List Message" в Salesbot. Следует добавить для отображения нового шага List Message в Salesbot. Поле не является обязательным. |
| services[0][pages] | string | Для WhatsApp сервиса содержит список элементов, которые можно выбрать при настройке CRM Plugin (кнопки на сайт) |
| services[0][pages][0][name] | string | Отображаемое пользователю название пункта в выпадающем списке при настройке кнопки на сайте |
| services[0][pages][0][id] | string | Идентификатор пункта в выпадающем списке (не отображается клиенту и пользователю) |
| services[0][pages][0][link] | string | Номер телефона, который будет указан в кнопке WhatsApp и которому будет писать клиент на странице сайта. В CRM Plugin ссылка будет сформирована следующим образов:  номер телефона} |

#### Пример запроса

В данном примере мы обновим 2 источника.  
У одного изменим имя, у другого сменим воронку

```json
[
{
"id": 9619,
"name": "Номер отдела продаж"
},
{
"id": 4460,
"name": "Лендинг",
"pipeline\_id": 1307
}
]
```

#### Заголовок типа данных при успешном результате

*Content-Type: application/hal+json*

#### Заголовок типа данных при ошибке

*Content-Type: application/problem+json*

#### HTTP коды ответа

| Код ответа | Условие |
| --- | --- |
| 200 | Источники были успешно изменены |
| 401 | Интеграция не авторизована |
| 400 | Переданы некорректные данные. Подробности доступны в теле ответа |

#### Параметры ответа

Метод возвращает коллекцию источников, которые были изменены.

| Параметр | Тип данных | Описание |
| --- | --- | --- |
| id | int | ID источника |
| name | string | Название источника |
| pipeline\_id | int | ID воронки, воронка может быть архивной |
| external\_id | string | Внешний идентификатор источника на стороне интеграции |
| default | bool | Является ли данный источник источником по-умолчанию. Поле не является обязательным |
| origin\_code | string | Код основного канала источника. Данный канал чата будет использоваться при инициализации общения. Поле не является обязательным. |
| services | array | Массив сервисов которые связаны с источником. На данный момент поддерживается только WhatsApp. Данные из этого массива используются для отображения в [CRM Plugin](/support/incoming_leads/dp_button) (кнопки на сайт). Поле не является обязательным. |
| services[0][type] | string | тип сервиса, на данный момент поддерживается только один тип: `whatsapp` |
| services[0][params] | object | Объект с настройками источника. Поле не является обязательным. |
| services[0][params][waba] | bool | Является ли источник белым WhatsApp. Следует добавить для возможности работы с одобренными шаблонами WhatsApp в Salesbot в новом шаге отправки сообщения. Поле не является обязательным. |
| services[0][params][is\_supports\_list\_message] | bool | Поддерживает ли источник шаг "List Message" в Salesbot. Следует добавить для отображения нового шага List Message в Salesbot. Поле не является обязательным. |
| services[0][pages] | string | Для WhatsApp сервиса содержит список элементов, которые можно выбрать при настройке CRM Plugin (кнопки на сайт) |
| services[0][pages][0][name] | string | Отображаемое пользователю название пункта в выпадающем списке при настройке кнопки на сайте |
| services[0][pages][0][id] | string | Идентификатор пункта в выпадающем списке (не отображается клиенту и пользователю) |
| services[0][pages][0][link] | string | Номер телефона, который будет указан в кнопке WhatsApp и которому будет писать клиент на странице сайта. В CRM Plugin ссылка будет сформирована следующим образов:  номер телефона} |
| request\_id | string | Строка переданная при запросе или порядковый указатель, если параметр не передан |

#### Пример ответа

```json
{
"\_total\_items": 2,
"\_links": {
"self": {
"href": "https://example.amocrm.ru/api/v4/sources"
}
},
"\_embedded": {
"sources": [
{
"id": 9619,
"name": "Номер отдела продаж",
"pipeline\_id": 1300,
"external\_id": "+17 912 100 00 00",
"default": true,
"origin\_code": null,
"services": [],
"\_links": {
"self": {
"href": "https://example.amocrm.ru/api/v4/sources/9619"
}
}
},
{
"id": 4460,
"name": "Лендинг",
"pipeline\_id": 1307,
"external\_id": "65bd500b-fd52-4599-ab58-943ce3dd058c",
"origin\_code": "amo.ext.30490163\_v2",
"default": false,
"services": [],
"\_links": {
"self": {
"href": "https://example.amocrm.ru/api/v4/sources/4460"
}
}
}
]
}
}
```

### Удаление источников

#### Метод

*DELETE /api/v4/sources*

#### Описание

Метод позволяет удалить источники пакетно.  
Также вы можете добавить ID источника в метод для удаления конкретного источника (/api/v4/sources/{id}).  
При пакетном удалении передается массив из объектов-источников, при удалении одного источника, тело запроса передавать не требуется.

#### Ограничения

Метод доступен с правами администратора.

#### Заголовок запроса

*Content-Type: application/json*

#### Параметры запроса

| Параметр | Тип данных | Описание |
| --- | --- | --- |
| id | int | ID источника, обязателен при пакетном удалении |

#### Пример запроса

```json
[
{
"id": 9619
},
{
"id": 4460
}
]
```

#### HTTP коды ответа

| Код ответа | Условие |
| --- | --- |
| 204 | Источники были успешно удалены |
| 401 | Интеграция не авторизована |
| 400 | Не удалось найти источники при пакетном удалении. Подробности доступны в теле ответа |
| 404 | У интеграции нет подконтрольных источников или источник не найден (при указании конкретного источника) |

#### Параметры ответа

Метод возвращает данные, если источники не были найдены при пакетном удалении

| Параметр | Тип данных | Описание |
| --- | --- | --- |
| request\_id | string | Строка переданная при запросе или порядковый указатель, если параметр не передан |

#### Пример ответа

```json
{
"errors": [
{
"request\_id": "0",
"errors": {
"code": "EntityNotFound",
"path": "id",
"detail": "source with id = 31075178 not found"
}
}
],
"title": "Bad Request",
"type": "https://httpstatus.es/400",
"status": 400,
"detail": "Invalid request items"
}
```

### Создание CRM Plugin

#### Метод

*POST /api/v4/website\_buttons*

#### Описание

Метод позволяет создать CRM Plugin.  
Источник в воронке создается сразу, а настройки CRM Plugin – асинхронно (не в контексте запроса).

#### Ограничения

Метод доступен с правами администратора.  
Метод доступен только интеграциям.  
Максимальное количество доверенных доменов: 10.

#### Заголовок запроса

*Content-Type: application/json*

#### Параметры запроса

| Параметр | Тип данных | Описание |
| --- | --- | --- |
| pipeline\_id | int | ID воронки, обязательный параметр |
| trusted\_websites | array | Доверенные домены, где будет загружаться CRM Plugin, необязательный параметр |
| is\_used\_in\_app | bool | Необязательный параметр, который должен передаваться, если CRM Plugin создается без доверенных доменов |

#### Пример запроса

```json
{
"pipeline\_id": 806215,
"trusted\_websites": ["example.com"]
}
```

#### HTTP коды ответа

| Код ответа | Условие |
| --- | --- |
| 202 | Источник создан успешно, успешно запущен процесс создания CRM Plugin |
| 401 | Интеграция не авторизована |
| 400 | Не удалось найти указанную вороку в аккаунте |
| 400 | Передан пустой массив "trusted\_websites" при параметре "is\_used\_in\_app" равном false |
| 400 | Неправильный формат параметров в теле запроса |

#### Параметры ответа

Метод возвращает ID созданного источника и массив доверенных доменов.

| Параметр | Тип данных | Описание |
| --- | --- | --- |
| source\_id | int | ID созданного источника в воронке |
| trusted\_websites | array | Массив доверенных доменов, которые будут относиться к CRM Plugin |

#### Пример ответа

```json
{
"source\_id": 62112321,
"trusted\_websites": ["example.com"]
}
```

### Подключение онлайн-чата к CRM Plugin

#### Метод

*POST /api/v4/website\_buttons/{source\_id}/online\_chat*

#### Описание

Метод позволяет подключить к CRM Plugin онлайн-чат.  
Создание онлайн-чата и подключение его к CRM Plugin происходит асинхронно (не в контексте запроса).

#### Ограничения

Метод доступен с правами администратора.  
Метод доступен только интеграциям.  
CRM Plugin к которому подключается онлайн-чат, должен относиться к воронке.  
Один онлайн-чат на воронку. Если онлайн-чат уже есть в одной воронке с источником, будет подключен он.

#### Заголовок запроса

*Content-Type: application/json*

#### HTTP коды ответа

| Код ответа | Условие |
| --- | --- |
| 202 | Успешно принят запрос на подключение онлайн-чата |
| 401 | Интеграция не авторизована |
| 404 | Указанный источник не найден |

#### Параметры ответа

Метод возвращает пустой ответ 202.

#### Пример ответа

202

```json
{
}
```

### Изменение CRM Plugin

#### Метод

*PATCH /api/v4/website\_buttons/{source\_id}*

#### Описание

Метод позволяет внести изменения в существующий CRM Plugin.  
Доступно добавление новых доверенных доменов к существующему CRM Plugin.  
Добавление доверенных доменов происходит асинхронно (не в контексте запроса).

#### Ограничения

Метод доступен с правами администратора.  
Метод доступен только интеграциям.  
Дополнительный домены будут добавлены только в случае, когда в текущем списке есть хотя бы один.

#### Заголовок запроса

*Content-Type: application/json*

#### Параметры запроса

| Параметр | Тип данных | Описание |
| --- | --- | --- |
| add | array | Массив доменов на добавление |

#### Пример запроса

```json
{
"trusted\_websites": {
"add": ["my-website.com"],
}
}
```

#### HTTP коды ответа

| Код ответа | Условие |
| --- | --- |
| 200 | Успешно принят запрос на добавление доверенных доменов |
| 401 | Интеграция не авторизована |
| 404 | Указанный источник не найден |

#### Параметры ответа

Метод возвращает модель кнопки, включая скрипт, встраиваемый на вебсайт

| Параметр | Тип данных | Описание |
| --- | --- | --- |
| account\_id | int | ID аккаунта |
| source\_id | int | ID источника |
| button\_id | int | ID кнопки, связанной с источником |
| is\_duplication\_control\_enabled | bool | статус наличия контроля дублей для источников |
| name | string | название истчника |
| creation\_status | string | статус создания источника ("created" или "creation\_pending") |
| pipeline\_id | int null | ID воронки |
| script | string null | скрипт CRM Plugin |

#### Пример ответа

200

```json
{
"account\_id": 22521521,
"source\_id": 64646723,
"button\_id": 27537,
"is\_duplication\_control\_enabled": false,
"name": "",
"creation\_status": "created",
"pipeline\_id": 591512,
"script": "(function(a,m,o,c,r,m){a[m]={id:\"401034\",hash:\"7be6ba7b6a01795643f8c3a1f2d5e031b1438277be6f8841bf069e9f242ca4e8\",locale:\"ru\",inline:false,setMeta:function(p){this.params=(this.params||[]).concat([p])}};a[o]=a[o]||function(){(a[o].q=a[o].q||[]).push(arguments)};var d=a.document,s=d.createElement('script');s.async=true;s.id=m+'\_script';s.src='https://gso.amocrm.ru/js/button.js';d.head&&d.head.appendChild(s)}(window,0,'amoSocialButton',0,0,'amo\_social\_button'));"
}
```

### Получение одного CRM Plugin

#### Метод

*GET /api/v4/website\_buttons/{source\_id}*

#### Описание

Метод позволяет получить параметры модели одного CRM Plugin.

#### Ограничения

Метод доступен с правами администратора.

#### Заголовок запроса

*Content-Type: application/json*

#### GET параметры

| Параметр | Тип данных | Описание |
| --- | --- | --- |
| with | string | Данный параметр принимает строку, в том числе из нескольких значений, указанных через запятую. Данный метод поддерживает [следующие параметры](#Параметры-для-GET-параметра-with). |

#### HTTP коды ответа

| Код ответа | Условие |
| --- | --- |
| 200 | Запрос выполнен успешно |
| 401 | Клиент не авторизован |
| 404 | Указанный источник не найден |

#### Параметры ответа

Метод возвращает модель CRM Plugin, включая скрипт, встраиваемый на вебсайт

| Параметр | Тип данных | Описание |
| --- | --- | --- |
| account\_id | int | ID аккаунта |
| source\_id | int | ID источника |
| button\_id | int | ID кнопки, связанной с источником |
| is\_duplication\_control\_enabled | bool | статус наличия контроля дублей для источников |
| name | string | название истчника |
| creation\_status | string | статус создания источника ("created" или "creation\_pending") |
| pipeline\_id | int null | ID воронки |
| script | string null | скрипт CRM Plugin |

#### Пример ответа

200

```json
{
"account\_id": 22521521,
"source\_id": 64646723,
"button\_id": 27537,
"is\_duplication\_control\_enabled": false,
"name": "",
"creation\_status": "created",
"pipeline\_id": 591512,
"script": "(function(a,m,o,c,r,m){a[m]={id:\"401034\",hash:\"7be6ba7b6a01795643f8c3a1f2d5e031b1438277be6f8841bf069e9f242ca4e8\",locale:\"ru\",inline:false,setMeta:function(p){this.params=(this.params||[]).concat([p])}};a[o]=a[o]||function(){(a[o].q=a[o].q||[]).push(arguments)};var d=a.document,s=d.createElement('script');s.async=true;s.id=m+'\_script';s.src='https://gso.amocrm.ru/js/button.js';d.head&&d.head.appendChild(s)}(window,0,'amoSocialButton',0,0,'amo\_social\_button'));"
}
```

### Получение списка CRM Plugin

#### Метод

*GET /api/v4/website\_buttons*

#### Описание

Метод позволяет получить пагинированный список параметров моделей всех CRM Plugin в аккаунте.

#### Ограничения

Метод доступен с правами администратора.

#### Заголовок запроса

*Content-Type: application/json*

#### GET параметры

| Параметр | Тип данных | Описание |
| --- | --- | --- |
| with | string | Данный параметр принимает строку, в том числе из нескольких значений, указанных через запятую. Данный метод поддерживает [следующие параметры](#Параметры-для-GET-параметра-with). |
| page | int | Номер страницы. По умолчанию 1. |
| limit | int | Количество моделей CRM Plugin на странице. По умолчанию 250. Маскимум 250. |

#### Заголовок типа данных при успешном результате

*Content-Type: application/hal+json*

#### Заголовок типа данных при ошибке

*Content-Type: application/problem+json*

#### HTTP коды ответа

| Код ответа | Условие |
| --- | --- |
| 200 | Запрос выполнен успешно |
| 401 | Клиент не авторизован |

#### Параметры ответа

Метод возвращает список моделей CRM Plugin, включая скрипты, встраиваемые на вебсайт

| Параметр | Тип данных | Описание |
| --- | --- | --- |
| account\_id | int | ID аккаунта |
| source\_id | int | ID источника |
| button\_id | int | ID кнопки, связанной с источником |
| is\_duplication\_control\_enabled | bool | статус наличия контроля дублей для источников |
| name | string | название истчника |
| creation\_status | string | статус создания источника ("created" или "creation\_pending") |
| pipeline\_id | int null | ID воронки |
| script | string null | скрипт CRM Plugin |

#### Пример ответа

200

```json
{
"\_page": 1,
"\_links": {
"self": {
"href": "https://example.amocrm.ru/api/v4/website\_buttons/?with=scripts&page=1&limit=250"
}
},
"\_embedded": {
"website\_buttons": [
{
"account\_id": 31952118,
"source\_id": 29181,
"button\_id": 401034,
"is\_duplication\_control\_enabled": false,
"name": "",
"creation\_status": "created",
"pipeline\_id": 7714034,
"script": "(function(a,m,o,c,r,m){a[m]={id:\"400\",hash:\"gerwertew\",locale:\"ru\",inline:false,setMeta:function(p){this.params=(this.params||[]).concat([p])}};a[o]=a[o]||function(){(a[o].q=a[o].q||[]).push(arguments)};var d=a.document,s=d.createElement('script');s.async=true;s.id=m+'\_script';s.src='https://gso.amocrm.ru/js/button.js';d.head&&d.head.appendChild(s)}(window,0,'amoSocialButton',0,0,'amo\_social\_button'));"
},
{
"account\_id": 31952118,
"source\_id": 29193,
"button\_id": 401040,
"is\_duplication\_control\_enabled": false,
"name": "",
"creation\_status": "created",
"pipeline\_id": 7714034,
"script": "(function(a,m,o,c,r,m){a[m]={id:\"401\",hash:\"dsgfsdgqwe123\",locale:\"ru\",inline:false,setMeta:function(p){this.params=(this.params||[]).concat([p])}};a[o]=a[o]||function(){(a[o].q=a[o].q||[]).push(arguments)};var d=a.document,s=d.createElement('script');s.async=true;s.id=m+'\_script';s.src='https://gso.amocrm.ru/js/button.js';d.head&&d.head.appendChild(s)}(window,0,'amoSocialButton',0,0,'amo\_social\_button'));"
},
{
"account\_id": 31952118,
"source\_id": 29223,
"button\_id": 401046,
"is\_duplication\_control\_enabled": false,
"name": "",
"creation\_status": "created",
"pipeline\_id": 7714482,
"script": "(function(a,m,o,c,r,m){a[m]={id:\"402\",hash:\"dsgfsdg\",locale:\"ru\",inline:false,setMeta:function(p){this.params=(this.params||[]).concat([p])}};a[o]=a[o]||function(){(a[o].q=a[o].q||[]).push(arguments)};var d=a.document,s=d.createElement('script');s.async=true;s.id=m+'\_script';s.src='https://gso.amocrm.ru/js/button.js';d.head&&d.head.appendChild(s)}(window,0,'amoSocialButton',0,0,'amo\_social\_button'));"
}
]
}
}
```

#### Параметры для GET-параметра with

| Параметр | Описание |
| --- | --- |
| scripts | Добавляет в ответ скрипт CRM Plugin |