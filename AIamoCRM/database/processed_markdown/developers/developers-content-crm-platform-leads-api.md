---
title: "Сделки"
description: "Система amoCRM – удобная web программа для анализа продаж, доступная в режиме online из любой точки мира! Подробности узнавайте по указанным на сайте телефонам в Москве."
url: https://www.amocrm.ru/developers/content/crm/platform/leads-api
section: developers
---

В данном разделе описываются доступные методы для работы с сущностью сделки

### Оглавление

- [Список сделок](#leads-list)
- [Получение сделки по ID](#lead-detail)
- [Добавление сделок](#leads-add)
- [Комплексное добавление сделок с контактом и компанией](#leads-complex-add)
- [Редактирование сделок](#leads-edit)

### Список сделок

#### Метод

*GET /api/v4/leads*

#### Описание

Метод позволяет получить список сделок в аккаунте.

#### Ограничения

Метод доступен в соответствии с правами пользователя.

#### GET параметры

| Параметр | Тип данных | Описание |
| --- | --- | --- |
| with | string | Данный параметр принимает строку, в том числе из нескольких значений, указанных через запятую. [Данный метод поддерживает следующие параметры.](#with-a3787974-9c44-475e-8e7a-0b6888e81695-params) |
| page | int | Страница выборки |
| limit | int | Количество возвращаемых сущностей за один запрос (Максимум – 250) |
| query | string int | Поисковый запрос (Осуществляет поиск по заполненным полям сущности) |
| filter | object | Фильтр. Подробней про фильтры читайте в [отдельной статье](/developers/content/crm_platform/filters-api) |
| order | object | Сортировка результатов списка. Доступные поля для сортировки: created\_at, updated\_at, id. Доступные значения для сортировки: asc, desc. Пример: /api/v4/leads?order[updated\_at]=asc |

#### Заголовок типа данных при успешном результате

*Content-Type: application/hal+json*

#### Заголовок типа данных при ошибке

*Content-Type: application/problem+json*

#### HTTP коды ответа

| Код ответа | Условие |
| --- | --- |
| 200 | Запрос выполнен успешно |
| 401 | Пользователь не авторизован |
| 402 | Аккаунт не оплачен |

#### Параметры ответа

Метод возвращает коллекцию моделей сделок, рассмотрим ниже свойства сделки.

| Параметр | Тип данных | Описание |
| --- | --- | --- |
| id | int | ID сделки |
| name | string | Название сделки |
| price | int | Бюджет сделки |
| responsible\_user\_id | int | ID пользователя, ответственного за сделку |
| group\_id | int | ID группы, в которой состоит ответственны пользователь за сделку |
| status\_id | int | ID статуса, в который добавляется сделка, по-умолчанию – первый этап главной воронки |
| pipeline\_id | int | ID воронки, в которую добавляется сделка |
| loss\_reason\_id | int | ID причины отказа |
| source\_id | int | **Требуется GET параметр with.** ID источника сделки |
| created\_by | int | ID пользователя, создающий сделку |
| updated\_by | int | ID пользователя, изменяющий сделку |
| closed\_at | int | Дата закрытия сделки, передается в Unix Timestamp |
| created\_at | int | Дата создания сделки, передается в Unix Timestamp |
| updated\_at | int | Дата изменения сделки, передается в Unix Timestamp |
| closest\_task\_at | int | Дата ближайшей задачи к выполнению, передается в Unix Timestamp |
| is\_deleted | bool | Удалена ли сделка |
| custom\_fields\_values | array null | Массив, содержащий информацию по значениям дополнительных полей, заданных для данной сделки |
| score | int null | Скоринг сделки |
| account\_id | int | ID аккаунта, в котором находится сделка |
| labor\_cost | int | Тип поля "стоимость труда" показывает сколько времени было затрачено на работу со сделкой. Время исчисления в секундах |
| is\_price\_modified\_by\_robot | bool | **Требуется GET параметр with.** Изменен ли в последний раз бюджет сделки роботом |
| \_embedded | object | Данные вложенных сущностей |
| \_embedded[loss\_reason] | object | **Требуется GET параметр with.** Причина отказа сделки |
| \_embedded[loss\_reason][id] | int | ID причины отказа |
| \_embedded[loss\_reason][name] | string | Название причины отказа |
| \_embedded[tags] | array | Данные тегов, привязанных к сделке |
| \_embedded[tags][0] | object | Модель тега, привязанного к сделке |
| \_embedded[tags][0][id] | int | ID тега |
| \_embedded[tags][0][name] | string | Название тега |
| \_embedded[tags][0][color] | string|null | Цвет тега |
| \_embedded[contacts] | array | **Требуется GET параметр with.** Данные контактов, привязанных к сделке |
| \_embedded[contacts][0] | object | Данные контакта, привязанного к сделке |
| \_embedded[contacts][0][id] | int | ID контакта, привязанного к сделке |
| \_embedded[contacts][0][is\_main] | bool | Является ли контакт главным для сделки |
| \_embedded[companies] | array | Данные компании, привязанной к сделке, в данном массиве всегда 1 элемент, так как у сделки может быть только 1 компания |
| \_embedded[companies][0] | object | Данные компании, привязанного к сделке |
| \_embedded[companies][0][id] | int | ID контакта, привязанного к сделке |
| \_embedded[catalog\_elements] | array | **Требуется GET параметр with.** Данные элементов списков, привязанных к сделке |
| \_embedded[catalog\_elements][0] | object | Данные элемента списка, привязанного к сделке |
| \_embedded[catalog\_elements][0][id] | int | ID элемента, привязанного к сделке |
| \_embedded[catalog\_elements][0][metadata] | object | Мета-данные элемента |
| \_embedded[catalog\_elements][0][quantity] | int float | Количество элементов у сделки |
| \_embedded[catalog\_elements][0][catalog\_id] | int | ID списка, в котором находится элемент |
| \_embedded[catalog\_elements][0][price\_id] | int | ID поля типа Цена, которое будет установлено для привязанного элемента в сущности |

#### Пример ответа

```json
{
"\_page": 2,
"\_links": {
"self": {
"href": "https://example.amocrm.ru/api/v4/leads?limit=2&page=2"
},
"next": {
"href": "https://example.amocrm.ru/api/v4/leads?limit=2&page=3"
},
"first": {
"href": "https://example.amocrm.ru/api/v4/leads?limit=2&page=1"
},
"prev": {
"href": "https://example.amocrm.ru/api/v4/leads?limit=2&page=1"
}
},
"\_embedded": {
"leads": [
{
"id": 19619,
"name": "Сделка для примера",
"price": 46333,
"responsible\_user\_id": 123321,
"group\_id": 625,
"status\_id": 142,
"pipeline\_id": 1300,
"loss\_reason\_id": null,
"source\_id": null,
"created\_by": 321123,
"updated\_by": 321123,
"created\_at": 1453279607,
"updated\_at": 1502193501,
"closed\_at": 1483005931,
"closest\_task\_at": null,
"is\_deleted": false,
"custom\_fields\_values": null,
"score": null,
"account\_id": 5135160,
"\_links": {
"self": {
"href": "https://example.amocrm.ru/api/v4/leads/19619"
}
},
"\_embedded": {
"tags": [],
"companies": []
}
},
{
"id": 14460,
"name": "Сделка для примера 2",
"price": 655,
"responsible\_user\_id": 123321,
"group\_id": 625,
"status\_id": 142,
"pipeline\_id": 1300,
"loss\_reason\_id": null,
"source\_id": null,
"created\_by": 321123,
"updated\_by": 321123,
"created\_at": 1453279607,
"updated\_at": 1502193501,
"closed\_at": 1483005931,
"closest\_task\_at": null,
"is\_deleted": false,
"custom\_fields\_values": null,
"score": null,
"account\_id": 1351360,
"\_links": {
"self": {
"href": "https://example.amocrm.ru/api/v4/leads/14460"
}
},
"\_embedded": {
"tags": [],
"companies": []
}
}
]
}
}
```

#### Параметры для GET-параметра with

| Параметр | Описание |
| --- | --- |
| catalog\_elements | Добавляет в ответ связанные со сделками элементы списков |
| is\_price\_modified\_by\_robot | Добавляет в ответ свойство, показывающее, изменен ли в последний раз бюджет сделки роботом |
| loss\_reason | Добавляет в ответ расширенную информацию по причине отказа |
| contacts | Добавляет в ответ информацию о связанных со сделкой контактах |
| only\_deleted | Если передать данный параметр, то в ответе на запрос метода, вернутся удаленные сделки, которые еще находятся в корзине. В ответ вы получите модель сделки, у которой доступны дату изменения, ID пользователя сделавшего последнее изменение, её ID и параметр is\_deleted = true. |
| source\_id | Добавляет в ответ ID источника |

### Получение сделки по ID

#### Метод

*GET /api/v4/leads/{id}*

#### Описание

Метод позволяет получить данные конкретной сделки по ID.

#### Ограничения

Метод доступен в соответствии с правами пользователя.

#### GET параметры

| Параметр | Тип данных | Описание |
| --- | --- | --- |
| with | string | Данный параметр принимает строку, в том числе из нескольких значений, указанных через запятую. [Данный метод поддерживает следующие параметры.](#with-4ddbc99f-7fb3-4c0c-83f5-c58ec7b924be-params) |

#### Заголовок типа данных при успешном результате

*Content-Type: application/hal+json*

#### Заголовок типа данных при ошибке

*Content-Type: application/problem+json*

#### HTTP коды ответа

| Код ответа | Условие |
| --- | --- |
| 200 | Запрос выполнен успешно |
| 204 | Сделка с указанным ID не существует |
| 401 | Пользователь не авторизован |

#### Параметры ответа

Метод возвращает модель сделки, рассмотрим ниже её свойства.

| Параметр | Тип данных | Описание |
| --- | --- | --- |
| id | int | ID сделки |
| name | string | Название сделки |
| price | int | Бюджет сделки |
| responsible\_user\_id | int | ID пользователя, ответственного за сделку |
| group\_id | int | ID группы, в которой состоит ответственны пользователь за сделку |
| status\_id | int | ID статуса, в который добавляется сделка, по-умолчанию – первый этап главной воронки |
| pipeline\_id | int | ID воронки, в которую добавляется сделка |
| loss\_reason\_id | int | ID причины отказа |
| source\_id | int | **Требуется GET параметр with.** ID источника сделки |
| created\_by | int | ID пользователя, создающий сделку |
| updated\_by | int | ID пользователя, изменяющий сделку |
| closed\_at | int | Дата закрытия сделки, передается в Unix Timestamp |
| created\_at | int | Дата создания сделки, передается в Unix Timestamp |
| updated\_at | int | Дата изменения сделки, передается в Unix Timestamp |
| closest\_task\_at | int | Дата ближайшей задачи к выполнению, передается в Unix Timestamp |
| is\_deleted | bool | Удалена ли сделка |
| custom\_fields\_values | array null | Массив, содержащий информацию по значениям дополнительных полей, заданных для данной сделки |
| score | int null | Скоринг сделки |
| account\_id | int | ID аккаунта, в котором находится сделка |
| labor\_cost | int | Тип поля "стоимость труда" показывает сколько времени было затрачено на работу со сделкой. Время исчисления в секундах |
| is\_price\_modified\_by\_robot | bool | **Требуется GET параметр with.** Изменен ли в последний раз бюджет сделки роботом |
| \_embedded | object | Данные вложенных сущностей |
| \_embedded[loss\_reason] | object | **Требуется GET параметр with.** Причина отказа сделки |
| \_embedded[loss\_reason][id] | int | ID причины отказа |
| \_embedded[loss\_reason][name] | string | Название причины отказа |
| \_embedded[tags] | array | Данные тегов, привязанных к сделке |
| \_embedded[tags][0] | object | Модель тега, привязанного к сделке |
| \_embedded[tags][0][id] | int | ID тега |
| \_embedded[tags][0][name] | string | Название тега |
| \_embedded[tags][0][color] | string|null | Цвет тега |
| \_embedded[contacts] | array | **Требуется GET параметр with.** Данные контактов, привязанных к сделке |
| \_embedded[contacts][0] | object | Данные контакта, привязанного к сделке |
| \_embedded[contacts][0][id] | int | ID контакта, привязанного к сделке |
| \_embedded[contacts][0][is\_main] | bool | Является ли контакт главным для сделки |
| \_embedded[companies] | array | Данные компании, привязанной к сделке, в данном массиве всегда 1 элемент, так как у сделки может быть только 1 компания |
| \_embedded[companies][0] | object | Данные компании, привязанного к сделке |
| \_embedded[companies][0][id] | int | ID контакта, привязанного к сделке |
| \_embedded[catalog\_elements] | array | **Требуется GET параметр with.** Данные элементов списков, привязанных к сделке |
| \_embedded[catalog\_elements][0] | object | Данные элемента списка, привязанного к сделке |
| \_embedded[catalog\_elements][0][id] | int | ID элемента, привязанного к сделке |
| \_embedded[catalog\_elements][0][metadata] | object | Мета-данные элемента |
| \_embedded[catalog\_elements][0][quantity] | int float | Количество элементов у сделки |
| \_embedded[catalog\_elements][0][catalog\_id] | int | ID списка, в котором находится элемент |
| \_embedded[catalog\_elements][0][price\_id] | int | ID поля типа Цена, которое установлено для привязанного элемента в сущности |

#### Пример ответа

```json
{
"id": 3912171,
"name": "Example",
"price": 12,
"responsible\_user\_id": 504141,
"group\_id": 0,
"status\_id": 143,
"pipeline\_id": 3104455,
"loss\_reason\_id": 4203748,
"source\_id": null,
"created\_by": 504141,
"updated\_by": 504141,
"created\_at": 1585299171,
"updated\_at": 1590683337,
"closed\_at": 1590683337,
"closest\_task\_at": null,
"is\_deleted": false,
"custom\_fields\_values": null,
"score": null,
"account\_id": 28805383,
"is\_price\_modified\_by\_robot": false,
"\_links": {
"self": {
"href": "https://example.amocrm.ru/api/v4/leads/3912171"
}
},
"\_embedded": {
"tags": [
{
"id": 100667,
"name": "тест",
"color": null,
}
],
"catalog\_elements": [
{
"id": 525439,
"metadata": {
"quantity": 1,
"catalog\_id": 4521
}
}
],
"loss\_reason": [
{
"id": 4203748,
"name": "Пропала потребность",
"sort": 100000,
"created\_at": 1582117280,
"updated\_at": 1582117280,
"\_links": {
"self": {
"href": "https://example.amocrm.ru/api/v4/leads/loss\_reasons/4203748"
}
}
}
],
"companies": [
{
"id": 10971463,
"\_links": {
"self": {
"href": "https://example.amocrm.ru/api/v4/companies/10971463"
}
}
}
],
"contacts": [
{
"id": 10971465,
"is\_main": true,
"\_links": {
"self": {
"href": "https://example.amocrm.ru/api/v4/contacts/10971465"
}
}
}
]
}
}
```

#### Параметры для GET-параметра with

| Параметр | Описание |
| --- | --- |
| catalog\_elements | Добавляет в ответ связанные со сделками элементы списков |
| is\_price\_modified\_by\_robot | Добавляет в ответ свойство, показывающее, изменен ли в последний раз бюджет сделки роботом |
| loss\_reason | Добавляет в ответ расширенную информацию по причине отказа |
| contacts | Добавляет в ответ информацию о связанных со сделкой контактах |
| only\_deleted | Если передать данный параметр, то в ответе на запрос метода, вернутся удаленные сделки, которые еще находятся в корзине. В ответ вы получите модель сделки, у которой доступны дату изменения, ID пользователя сделавшего последнее изменение, её ID и параметр is\_deleted = true. |
| source\_id | Добавляет в ответ ID источника |

### Добавление сделок

#### Метод

*POST /api/v4/leads*

#### Описание

Метод позволяет добавлять сделки в аккаунт пакетно.

#### Ограничения

Метод доступен в соответствии с правами пользователя.

#### Заголовок запроса

*Content-Type: application/json*

#### Параметры запроса

Обязательные поля отсутствуют

| Параметр | Тип данных | Описание |
| --- | --- | --- |
| name | string | Название сделки. Поле не является обязательным |
| price | int | Бюджет сделки. Поле не является обязательным |
| status\_id | int | ID статуса, в который добавляется сделка. Поле не является обязательным, по-умолчанию – первый этап главной воронки |
| pipeline\_id | int | ID воронки, в которую добавляется сделка. Поле не является обязательным |
| created\_by | int | ID пользователя, создающий сделку. При передаче значения 0, сделка будет считаться созданной роботом. Поле не является обязательным |
| updated\_by | int | ID пользователя, изменяющий сделку. При передаче значения 0, сделка будет считаться измененной роботом. Поле не является обязательным |
| closed\_at | int | Дата закрытия сделки, передается в Unix Timestamp. Поле не является обязательным |
| created\_at | int | Дата создания сделки, передается в Unix Timestamp. Поле не является обязательным |
| updated\_at | int | Дата изменения сделки, передается в Unix Timestamp. Поле не является обязательным |
| loss\_reason\_id | int | ID причины отказа. Поле не является обязательным |
| responsible\_user\_id | int | ID пользователя, ответственного за сделку. Поле не является обязательным |
| custom\_fields\_values | array | Массив, содержащий информацию по дополнительным полям, заданным для данной сделки. Поле не является обязательным. [Примеры заполнения полей](/developers/content/crm_platform/custom-fields#cf-fill-examples) |
| tags\_to\_add | array | Массив тегов для добавления. |
| tags\_to\_add[0] | object | Модель тега для добавления. |
| tags\_to\_add[0][id] | array | ID тега для добавления. Важно передать или id или name. |
| tags\_to\_add[0][name] | array | Название тега для добавления. Важно передать или id или name. |
| \_embedded | object | Данные вложенных сущностей, при создании и редактировании можно передать только теги. Поле не является обязательным |
| \_embedded[tags] | array null | Данные тегов, добавляемых к сделке |
| \_embedded[tags][0] | object | Модель тега, добавляемого к сделке. Необходимо указать id или name |
| \_embedded[tags][0][id] | int | ID тега |
| \_embedded[contacts] | array | Данные контактов, которые будет прикреплены к сделке |
| \_embedded[contacts][0] | object | Модель контакта, добавляемого к сделке. Необходимо указать id |
| \_embedded[contacts][0][id] | int | ID контакта |
| \_embedded[contacts][0][is\_main] | string | Флаг, показывающий, является контакт главным или нет |
| \_embedded[companies] | array | Данные компании, которая будет прикреплена к сделке |
| \_embedded[companies][0] | object | Модель компании, добавляемой к сделке. Необходимо указать id |
| \_embedded[companies][0][id] | int | ID компании |
| \_embedded[source][external\_id] | int | Внешний ID источника. Источник можно добавить с помощью [API Исчтоников](https://www.amocrm.ru/developers/content/crm_platform/sources-api). Если передан external\_id источника и не передан pipeline\_id, сделка будет добавлена в воронку, в которой находится источник. |
| \_embedded[source][type] | string | Тип источника. Для сделок, добавляемых интеграциями, поддерживается только `widget` |

#### Пример запроса

В данном примере мы создадим 2 сделки.  
Для первой мы зададим название, бюджет, создателя – робота, а также значение текстового поля.  
Для второй сделки мы зададим название, бюджет и добавим тег.

```json
[
{
"name": "Сделка для примера 1",
"created\_by": 0,
"price": 20000,
"custom\_fields\_values": [
{
"field\_id": 294471,
"values": [
{
"value": "Наш первый клиент"
}
]
}
],
"tags\_to\_add": [
{
"name": "Первый тег"
},
{
"id": 217261
}
]
},
{
"name": "Сделка для примера 2",
"price": 10000,
"\_embedded": {
"tags": [
{
"id": 2719
}
]
}
}
]
```

#### Заголовок типа данных при успешном результате

*Content-Type: application/hal+json*

#### Заголовок типа данных при ошибке

*Content-Type: application/problem+json*

#### HTTP коды ответа

| Код ответа | Условие |
| --- | --- |
| 200 | Сделки были успешно созданы |
| 401 | Пользователь не авторизован |
| 400 | Переданы некорректные данные. Подробности доступны в теле ответа |

#### Параметры ответа

Метод возвращает коллекцию сделок, которые были созданы.

| Параметр | Тип данных | Описание |
| --- | --- | --- |
| id | int | ID сделки |
| request\_id | string | Строка переданная при запросе или порядковый указатель, если параметр не передан |

#### Пример ответа

```json
{
"\_links": {
"self": {
"href": "https://example.amocrm.ru/api/v4/leads"
}
},
"\_embedded": {
"leads": [
{
"id": 10185151,
"request\_id": "0",
"\_links": {
"self": {
"href": "https://example.amocrm.ru/api/v4/leads/10185151"
}
}
},
{
"id": 10185153,
"request\_id": "1",
"\_links": {
"self": {
"href": "https://example.amocrm.ru/api/v4/leads/10185153"
}
}
}
]
}
}
```

### Комплексное добавление сделок с контактом и компанией

#### Метод

*POST /api/v4/leads/complex*

#### Описание

Метод позволяет добавлять сделки c контактом и компанией в аккаунт пакетно. Добавляемые данные могут быть проверены в [контроле дублей](/developers/content/crm_platform/duplication-control).

#### Ограничения

Метод доступен в соответствии с правами пользователя.  
Для одной сделки можно указать не более 1 связанного контакта и 1 связанной компании.  
Для добавляемых сущностей (сделка, контакт, компания), можно передать не более 40 значений дополнительных полей.  
Добавляемые данные участвуют в [контроле дублей](/developers/content/crm_platform/duplication-control), если он включен для интеграции, которая добавляет данные.  
Метод не производит дедубликацию переданных данных, а только ищет дубли среди уже добавленных данных.  
За один запрос можно передать не более 50 сделок.  
При создании нового контакта и компании, они будут связаны между собой.

#### Заголовок запроса

*Content-Type: application/json*

#### Параметры запроса

Обязательные поля отсутствуют

| Параметр | Тип данных | Описание |
| --- | --- | --- |
| name | string | Название сделки. Поле не является обязательным |
| price | int | Бюджет сделки. Поле не является обязательным |
| status\_id | int | ID статуса, в который добавляется сделка. Поле не является обязательным, по-умолчанию – первый этап главной воронки |
| pipeline\_id | int | ID воронки, в которую добавляется сделка. Поле не является обязательным |
| created\_by | int | ID пользователя, создающий сделку. При передаче значения 0, сделка будет считаться созданной роботом. Поле не является обязательным |
| updated\_by | int | ID пользователя, изменяющий сделку. При передаче значения 0, сделка будет считаться измененной роботом. Поле не является обязательным |
| closed\_at | int | Дата закрытия сделки, передается в Unix Timestamp. Поле не является обязательным |
| created\_at | int | Дата создания сделки, передается в Unix Timestamp. Поле не является обязательным |
| updated\_at | int | Дата изменения сделки, передается в Unix Timestamp. Поле не является обязательным |
| loss\_reason\_id | int | ID причины отказа. Поле не является обязательным |
| responsible\_user\_id | int | ID пользователя, ответственного за сделку. Поле не является обязательным |
| custom\_fields\_values | array | Массив, содержащий информацию по дополнительным полям, заданным для данной сделки. Поле не является обязательным. [Примеры заполнения полей](/developers/content/crm_platform/custom-fields#cf-fill-examples) Можно передать не более 40 полей для одной сделки. Если необходимо передать больше – вы можете выполнить операцию обновления после создания или создать через общий метод, который не производит контроля дублей |
| tags\_to\_add | array | Массив тегов для добавления. |
| tags\_to\_add[0] | object | Модель тега для добавления. |
| tags\_to\_add[0][id] | array | ID тега для добавления. Важно передать или id или name. |
| tags\_to\_add[0][name] | array | Название тега для добавления. Важно передать или id или name. |
| \_embedded | object | Данные вложенных сущностей, при создании можно передать теги, данные связанного контакта, данные связанной компании, метаданные (если создаем неразобранное). Поле не является обязательным |
| \_embedded[tags] | array null | Данные тегов, добавляемых к сделке |
| \_embedded[tags][0] | object | Модель тега, добавляемого к сделке. Необходимо указать id или name |
| \_embedded[tags][0][id] | int | ID тега |
| \_embedded[contacts] | array | Данные контакта, который будет прикреплен к сделке |
| \_embedded[contacts][0] | object | Данные контакта, который будет прикреплен к сделке. Можно передать поле \_embedded[contacts][0][id] с ID контакта или полную модель контакта. В моделе должно быть передано не более 40 значений дополнительных полей. Подробней о параметрах контакта читайте в разделе [Параметры запроса](https://amocrm.ru/developers/content/crm_platform/contacts-api#contacts-add) |
| \_embedded[companies] | array | Данные компании, которая будет прикреплена к сделке |
| \_embedded[companies][0] | object | Данные компании, которая будет прикреплена к сделке.Можно передать поле \_embedded[companies][0][id] с ID контакта или полную модель компании. В моделе должно быть передано не более 40 значений дополнительных полей. Подробней о параметрах компании читайте в разделе [Параметры запроса](https://amocrm.ru/developers/content/crm_platform/companies-api#companies-add) |
| \_embedded[metadata] | array | Массив, содержащий метаданные для заявки, создаваемой в неразобранном. Если переданы метаданные, мы считаем, что это неразобранное сделки и переданный статус, отличный от статус Неразобранное будет проигнорирован Параметры аналогичны тем, что передаются при создании неразобранного, за исключением необходимости передачи дополнительного ключа category.Подробней о параметрах метаданных читайте [тут](https://amocrm.ru/developers/content/crm_platform/unsorted-api#metadata-description) |
| \_embedded[metadata][category] | string | Категория неразобранного. Допустимые варианты – sip, forms |
| \_embedded[source][external\_id] | int | Внешний ID источника. Источник можно добавить с помощью [API Исчтоников](https://www.amocrm.ru/developers/content/crm_platform/sources-api). Если передан external\_id источника и не передан pipeline\_id, сделка будет добавлена в воронку, в которой находится источник. |
| \_embedded[source][type] | string | Тип источника. Для сделок, добавляемых интеграциями, поддерживается только `widget` |

#### Пример запроса

В данном примере мы создадим сделку с контактом и компанией, а также неразобранную сделку категории формы в статусе неразобранное с контактом.

```json
[
{
"name": "Название сделки",
"price": 3422,
"\_embedded":{
"contacts":[
{
"first\_name":"Екатерина",
"created\_at":1608905348,
"responsible\_user\_id":2004184,
"updated\_by":0,
"custom\_fields\_values":[
{
"field\_id":66186,
"values":[
{
"enum\_id":193200,
"value":"example@example.com"
}
]
},
{
"field\_id":66192,
"values":[
{
"enum\_id":193226,
"value":"+79123456789"
}
]
}
]
}
],
"companies":[
{
"name":"ООО Рога и Копыта"
}
]
},
"created\_at":1608905348,
"responsible\_user\_id":2004184,
"custom\_fields\_values":[
{
"field\_id":1286573,
"values":[
{
"value":"Поле текст"
}
]
},
{
"field\_id":1286575,
"values":[
{
"enum\_id":2957741
},
{
"enum\_id":2957743
}
]
}
],
"status\_id":33929752,
"pipeline\_id":3383152,
"request\_id": "qweasd"
},
{
"name": "Название сделки",
"price": 3422,
"\_embedded":{
"metadata":{
"category": "forms",
"form\_id": 123,
"form\_name": "Форма на сайте",
"form\_page": "https://example.com",
"form\_sent\_at": 1608905348,
"ip": "8.8.8.8",
"referer": "https://example.com/form.html"
},
"contacts":[
{
"first\_name":"Евгений",
"custom\_fields\_values":[
{
"field\_code":"EMAIL",
"values":[
{
"enum\_code":"WORK",
"value":"unsorted\_example@example.com"
}
]
},
{
"field\_code":"PHONE",
"values":[
{
"enum\_code":"WORK",
"value":"+79129876543"
}
]
}
]
}
]
},
"status\_id":33929749,
"pipeline\_id":3383152,
"request\_id": "uns\_qweasd"
}
]
```

#### Заголовок типа данных при успешном результате

*Content-Type: application/hal+json*

#### Заголовок типа данных при ошибке

*Content-Type: application/problem+json*

#### HTTP коды ответа

| Код ответа | Условие |
| --- | --- |
| 200 | Сделки были успешно созданы |
| 401 | Пользователь не авторизован |
| 400 | Переданы некорректные данные. Подробности доступны в теле ответа |

#### Параметры ответа

Метод возвращает информацию о сущностях, которые были созданы или обновлены, если найден дубль.

| Параметр | Тип данных | Описание |
| --- | --- | --- |
| id | int | ID сделки |
| contact\_id | int null | ID контакта |
| company\_id | int null | ID компании |
| merged | bool | Флаг, который показывает, найден дубль подходящий под условия поиска дублей и произведено объединение или нет |
| request\_id | string[] | Массив строк с пользовательскими идентификаторами, которые были переданы с каждой сущностью. Если дубли не найдены, в массиве всегда будет 1 элемент. Множественное значение может вернуться в случае, если передано несколько дублей одной и той же сделки. В такой случае вернется результирующая сделка, а в массиве request\_id будут идентификаторы переданных сделок, которые являются дублями. |

#### Пример ответа

```json
[
{
"id":15198335,
"contact\_id":19663157,
"company\_id":19663155,
"request\_id":[
"qweasd"
],
"merged":false
},
{
"id":15198337,
"contact\_id":19663161,
"company\_id":19663159,
"request\_id":[
"uns\_qweasd"
],
"merged":false
}
]
```

### Редактирование сделок

#### Метод

*PATCH /api/v4/leads*

#### Описание

Метод позволяет редактировать сделки пакетно.  
Также вы можете добавить ID сделки в метод для редактирования конкретной сделки (/api/v4/leads/{id}).  
При редактировании пакетно передается массив из объектов-сделок, при редактировании одной сделки, передается просто модель сделки.

#### Ограничения

Метод доступен в соответствии с правами пользователя.

#### Заголовок запроса

*Content-Type: application/json*

#### Параметры запроса

Обязательные поля отсутствуют

| Параметр | Тип данных | Описание |
| --- | --- | --- |
| id | int | ID сделки |
| name | string | Название сделки. Поле не является обязательным |
| price | int | Бюджет сделки. Поле не является обязательным |
| status\_id | int | ID статуса, в который добавляется сделка. Поле не является обязательным, по-умолчанию – первый этап главной воронки |
| pipeline\_id | int | ID воронки, в которую добавляется сделка. Поле не является обязательным |
| created\_by | int | ID пользователя, создающий сделку. При передаче значения 0, сделка будет считаться созданной роботом. Поле не является обязательным |
| updated\_by | int | ID пользователя, изменяющий сделку. При передаче значения 0, сделка будет считаться измененной роботом. Поле не является обязательным |
| closed\_at | int | Дата закрытия сделки, передается в Unix Timestamp. Поле не является обязательным |
| created\_at | int | Дата создания сделки, передается в Unix Timestamp. Поле не является обязательным |
| updated\_at | int | Дата изменения сделки, передается в Unix Timestamp. Поле не является обязательным |
| loss\_reason\_id | int | ID причины отказа. Поле не является обязательным |
| responsible\_user\_id | int | ID пользователя, ответственного за сделку. Поле не является обязательным |
| custom\_fields\_values | array | Массив, содержащий информацию по дополнительным полям, заданным для данной сделки. Поле не является обязательным. [Примеры заполнения полей](/developers/content/crm_platform/custom-fields#cf-fill-examples) |
| tags\_to\_add | array | Массив тегов для добавления. |
| tags\_to\_add[0] | object | Модель тега для добавления. |
| tags\_to\_add[0][id] | array | ID тега для добавления. Важно передать или id или name. |
| tags\_to\_add[0][name] | array | Название тега для добавления. Важно передать или id или name. |
| tags\_to\_delete | array | Массив тегов для удаления. |
| tags\_to\_delete[0] | object | Модель тега для удаления. |
| tags\_to\_delete[0][id] | array | ID тега для удаления. Важно передать или id или name. |
| tags\_to\_delete[0][name] | array | Название тега для удаления. Важно передать или id или name. |
| \_embedded | object | Данные вложенных сущностей, при создании и редактировании можно передать только теги. Поле не является обязательным |
| \_embedded[tags] | array|null | Данные тегов, добавляемых к сделке |
| \_embedded[tags][0] | object | Модель тега, добавляемого к сделке. Необходимо указать id или name |
| \_embedded[tags][0][id] | int | ID тега |
| \_embedded[tags][0][name] | string | Название тега |

#### Пример запроса

В данном примере мы обновим 2 сделки.  
Для первой мы изменим статус и воронку, добавим причину отказа, установим дату закрытия, а также добавим новый тег и удалим старый  
Для второй сделки мы изменим бюджет, воронку и статус, а также удалим теги.

```json
[
{
"id": 54886,
"pipeline\_id": 47521,
"status\_id": 143,
"closed\_at": 1589297221,
"loss\_reason\_id": 7323,
"updated\_by": 0,
"tags\_to\_add": [
{
"name": "Второй тег"
}
],
"tags\_to\_delete": [
{
"name": "Первый тег"
}
]
},
{
"id": 54884,
"price": 50000,
"pipeline\_id": 47521,
"status\_id": 525743,
"\_embedded": {
"tags": null
}
}
]
```

#### Заголовок типа данных при успешном результате

*Content-Type: application/hal+json*

#### Заголовок типа данных при ошибке

*Content-Type: application/problem+json*

#### HTTP коды ответа

| Код ответа | Условие |
| --- | --- |
| 200 | Сделки были успешно изменены |
| 401 | Пользователь не авторизован |
| 400 | Переданы некорректные данные. Подробности доступны в теле ответа |

#### Параметры ответа

Метод возвращает коллекцию сделок, которые были изменены.

| Параметр | Тип данных | Описание |
| --- | --- | --- |
| id | int | ID сделки |
| updated\_at | int | Unix Timestamp изменения сделки |

#### Пример ответа

```json
{
"\_links": {
"self": {
"href": "https://example.amocrm.ru/api/v4/leads"
}
},
"\_embedded": {
"leads": [
{
"id": 54886,
"updated\_at": 1589556420,
"\_links": {
"self": {
"href": "https://example.amocrm.ru/api/v4/leads/54886"
}
}
},
{
"id": 54884,
"updated\_at": 1589556420,
"\_links": {
"self": {
"href": "https://example.amocrm.ru/api/v4/leads/54884"
}
}
}
]
}
}
```