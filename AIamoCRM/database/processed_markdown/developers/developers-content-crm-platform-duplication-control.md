---
title: "Контроль дублей"
description: "Система amoCRM – удобная web программа для анализа продаж, доступная в режиме online из любой точки мира! Подробности узнавайте по указанным на сайте телефонам в Москве."
url: https://www.amocrm.ru/developers/content/crm/platform/duplication-control
section: developers
---

В релизе Осень 2020 появился функционал Контроль Дублей. Функционал позволяет выбрать для каких источников сделок и по каким данным отслеживать дубли для новых заявок, какие действия делать с дублями в разных кейсах.

В данный момент функционал поддерживает практически все стандартные источники, а также интеграции.

Рассмотрим логику настройки и работы функционала:

Контроль дублей настраивается отдельно для каждой воронки. На первой вкладке окна настройки вам необходимо выбрать какие источники поддерживают контроль дублей:

![](https://www.amocrm.ru/uploads/2021/01/doubles_2501-1024x967.png)

Окно разделено на 2 блока: источники и источники с ограниченной поддержкой поддержкой контроля дублей.  
Источники из первого блока поддерживают все доступные настройки (выбор параметров, поведение и тд).

На вкладке “Настройка правил” происходит настройка работы контроля дублей и правил, по которым дубли будут обработаны.

![](https://www.amocrm.ru/static/assets/developers/files/digital%20pipeline/duplication_control_settings.png)

На вкладке находится несколько блоков настроек, рассмотрим каждый из них.

#### Выбор параметров

В данном блоке настраиваются параметры, по которым будет происходить поиск дублей при добавлении данных в amoCRM. Всегда доступны для выбора следующие параметры:

- **BIG DATA**

  При выборе данного параметра мы проверим входящие данные заявки с помощью алгоритмов машинного обучения и данных amoCRM.  
  Для входящих заявок из чатов BIG DATA найдет дубли и объединит входящую заявку с существующей.  
  Для входящих заявок из других каналов, проверка по BIG DATA работает асинхронно, то есть уже после добавления заявки.  
  При этом объединение произойдет только если одна из дублирующихся сущностей находится в статусе неразобранное.  
  Стоит отметить, что асинхронная проверка по BIG DATA работает для всех заявок, вне зависимости добавлена она через новый метод API или через уже существующие (в том чисто и api/v2).  
  Также стоит отметить, что проверка происходит и при обновлении сущности (дополнение данных), главное условие – одна из сущностей, которые потенциально являются дублями, находится в статусе неразобранное.
- **Пиксель**

  При выборе данного параметра мы проверим наличие переданного пикселя с входящими данными и попробуем найти в вашем аккаунте сделки, которые связаны с этим пикселем.  
  Проверка по пикселю, в данный момент, работает только для входящих заявок из чатов.  
  Ваш клиент может получить пиксель при взаимодействии со страницами ваших сайтов, при наличии на них формы amoCRM и CRM Plugun, также пользователь может получить пиксель при переходе и написании в чаты социальных сетей через CRM Plugin.
- **Email**

  При выборе данного параметры мы проверим наличие email в данных переданного контакта со сделкой и попробуем найти в вашем аккаунте контакты с этим email и связанные с ними сделки, где найденный контакт является основным.  
  Данный параметр проверяется при создании заявок из форм, API (только через новый метод /api/v4/leads/complex) и других источников.
- **Телефон**

  При выборе данного параметры мы проверим наличие телефона в данных переданного контакта со сделкой и попробуем найти в вашем аккаунте контакты с этим телефоном и связанные с ними сделки, где найденный контакт является основным.  
  Важно отметить, что все телефоны приводятся для поиска к международному формату.  
  Если передан, например, внутренний номер, то поиск может не произойти или произойти не корректно.  
  Данный параметр проверяется при создании заявок из форм, API (только через новый метод /api/v4/leads/complex), чатов (если интеграция передает номер телефона вместе с профилем в первом сообщении) и других источников.
- **Значение дополнительного поля**

  Вы можете выбрать поля сделок и контактов, по которым необходимо сравнить входящие данные.  
  Для выбора доступны поля типа текст и число.  
  Мы проверим наличие выбранного поля в данных переданного контакта и сделки и попробуем найти в вашем аккаунте дубли.  
  Если используется поле контакта, то дублями будут считаться только те сделки, где найденный контакт является основным.  
  Данный параметр проверяется при создании заявок из форм, API (только через новый метод /api/v4/leads/complex) и других источников.

#### Выбор воронок и статусов, в которых ищутся дубли

В данном блоке выбираются статусы сделок, в которых мы будем искать дубли.  
То есть если сделка находится в не выбранном статусе, она не будет участвовать в сравнении данных при добавлении сделки в amoCRM.

#### При конфликте данных сделки с входящей заявки

В данном блоке настраивается поведение при конфликте данных. Для выбора доступно два варианта:

- Обновить данными из входящей заявки
- Оставить данные текущей сделки

При выборе варианта “Обновить данными из входящей заявки”, при нахождении дубля и конфликте входящих и существующих данных, существующая сделка будет обновлена входящими данными. Поля Телефон и Email будут дополнены новыми данными.

При выборе вариант “Оставить данные текущей сделки”, при нахождении дубля и конфликте входящих и существующих данных, существующая сделка не будет изменена.

#### При обнаружении нескольких дублей по входящей заявке

При нахождении более 1 дубля и не более 3, можно выбрать поведение контроля дублей. Если дублей найдено более 3, объединение не произойдет.  
Для выбора доступны следующие варианты поведения:

- Обновить все сделки

  При выборе данной настройки, все найденные сделки будут обновлены или дополнены данными, в зависимости от настройки в пункте “При конфликте данных сделки с входящей заявки
- Обновить самую новую сделку

  При выборе данной настройки, последняя созданная сделка будет обновлена или дополнена данными, в зависимости от настройки в пункте “При конфликте данных сделки с входящей заявки”
- Создать новую сделку

  При выборе данной настройки будет создана новая сделка

#### После объединения

Вы можете настроить создание задачи после выполнения операции обновления данных. Задача будет поставлена в те сделки, которые были найдены при поиске дублей. Если сделок было найдено более 3, то контроль дублей проигнорирует такую входящую заявку.

#### Ответы на вопросы:

1. Связан ли функционал поиска дублей и контроля дублей?

   Отчасти, поиск дублей ищет дубли в рамках всего аккаунта на основании BIG DATA, контроль дублей проверяет входящие заявки также на основании данных BIG DATA
2. Когда будут добавлены все источники в настройки поиска дублей?

   В ближайшее время мы добавим встроенные источники в контроль дублей. Интеграциям доступен [метод добавления сделок с поиском дублей](/developers/content/crm_platform/leads-api#leads-complex-add). После подготовки интеграции для работы с данным методом, необходимо в интеграции установить галку “Интеграция поддерживаем методы контроля дублей”. После добавления первой заявки, интеграция станет доступна в списке источников в настройках контроля дублей.
3. Где найти методы API с поддержкой контроля дублей?

   Документация к методу доступна по [ссылке](/developers/content/crm_platform/leads-api#leads-complex-add).
4. Добавляется ли примечание о склейке?

   Примечание о склейке добавляется только в сделки, которые были объединены на основании данных BIG DATA и Пикселя.
5. Почему при добавлении уже существующего в базе номера телефона, объединение не произошло?

   Объединение происходит только на основании данных, которые были переданы при создании сделки, за исключением контроля на основании BIG DATA.  
   Если включена проверка по BIG DATA, то даже при обновлении сущности (например бот заполнил телефон в неразобранной заявке), может произойти объединение. Главными условием для срабатывания объединения по BIG DATA являются: 1) включен контроль по BIG DATA, 2) включен контроль дублей для источника, из которого приходит последняя заявка в неразобранное, 3) одна из объединяемых сущностей находится в статусе неразобранное.
6. Будет ли добавлен контроль дублей в существующие методы API?

   В будущем мы планируем добавить контроль дублей в методы создания неразобранного. В методы создания сделки контроль дублей не планируется к добавлению.
7. Поддерживаются ли интеграции, которые работают через старые API ключи?

   Метод добавления сделок с контролем дублей идентифицирует источник на основании ID интеграции, поэтому при использовании метода с API ключом, контроль дублей не будет работать.